# Docker-based Cypress Component Tests

## –ü–æ—á–µ–º—É Docker?

Docker –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ** –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π –∏ CI/CD, —Ä–µ—à–∞—è –ø—Ä–æ–±–ª–µ–º—É —Ä–∞–∑–ª–∏—á–∏–π –≤ —à—Ä–∏—Ñ—Ç–∞—Ö –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
npm run test:screenshots

# –û–±–Ω–æ–≤–∏—Ç—å baseline —Å–∫—Ä–∏–Ω—à–æ—Ç—ã
npm run test:screenshots-update

# –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è (–±–µ–∑ Docker, –±—ã—Å—Ç—Ä–µ–µ –Ω–æ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç CI)
npm run test:screenshots-local
npm run test:screenshots-local-update
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
- **~30-60 —Å–µ–∫—É–Ω–¥** - —Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –û–±—Ä–∞–∑ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è —Å –º–µ—Ç–∫–æ–π –ø–∞–∫–µ—Ç–æ–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏
- **~5-10 —Å–µ–∫—É–Ω–¥** - –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –û–±—Ä–∞–∑ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–∫—ç—à)
- ‚úÖ –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ volumes (–±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚úÖ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ package.json/package-lock.json

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **Volume mounting**: –ö–æ–¥ –Ω–µ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑, –∞ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
2. **Smart rebuild**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
3. **Layer caching**: Docker –∫—ç—à–∏—Ä—É–µ—Ç —Å–ª–æ–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–±–æ—Ä–∫–∏
4. **Optimized context**: .dockerignore –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# 1. –ü—Ä–æ–≤–µ—Ä—è—é—Ç –Ω—É–∂–Ω–∞ –ª–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ (–ø–æ —Ö–µ—à—É package.json)
# 2. –ò—Å–ø–æ–ª—å–∑—É—é—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑ –µ—Å–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
# 3. –ú–æ–Ω—Ç–∏—Ä—É—é—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —á–µ—Ä–µ–∑ volumes (instant start)
# 4. –ó–∞–ø—É—Å–∫–∞—é—Ç Cypress —Ç–µ—Å—Ç—ã
# 5. –ö–æ–ø–∏—Ä—É—é—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Ö–æ—Å—Ç
# 6. –û—Ä–≥–∞–Ω–∏–∑—É—é—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
frontend/
‚îú‚îÄ‚îÄ Dockerfile.cypress                      # –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
‚îú‚îÄ‚îÄ docker-compose.cypress.yml              # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π compose —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ packages/cypress/
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docker-test-component.sh       # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docker-update-snapshots.sh     # –°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è baseline
‚îÇ   ‚îú‚îÄ‚îÄ collect-baseline.cjs               # –°–±–æ—Ä baseline –¥–ª—è Docker
‚îÇ   ‚îî‚îÄ‚îÄ organize-snapshots.cjs             # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îî‚îÄ‚îÄ view/
    ‚îî‚îÄ‚îÄ components/
        ‚îî‚îÄ‚îÄ InfoBlock/
            ‚îî‚îÄ‚îÄ __tests__/
                ‚îî‚îÄ‚îÄ __snapshots__/          # Baseline —Å–∫—Ä–∏–Ω—à–æ—Ç—ã (–∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ git)
                    ‚îú‚îÄ‚îÄ index.cy.tsx-InfoBlock-base.png
                    ‚îî‚îÄ‚îÄ __diff_images__/    # –†–∞–∑–ª–∏—á–∏—è (–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è git)

# cypress-image-diff-screenshots/ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞–º–∏

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–π –æ–±—Ä–∞–∑
docker images cypress-component-tests:cache

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
docker build -f Dockerfile.cypress -t cypress-component-tests:cache . --no-cache

# –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
docker image prune -f

# –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑ –¥–ª—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
docker rmi cypress-component-tests:cache
```

## CI/CD

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Docker –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:
- `.github/workflows/front-test-screenshots.yml`
- –ö—ç—à–∏—Ä—É–µ—Ç Docker —Å–ª–æ–∏ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ —Å–∫—Ä–∏–ø—Ç—ã —á—Ç–æ –∏ –ª–æ–∫–∞–ª—å–Ω–æ

## Troubleshooting

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä Docker context
du -sh .

# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .dockerignore –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
cat .dockerignore
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å permissions (Linux)
```bash
# –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç –ø—Ä–∞–≤–∞
# –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –≤—Ä—É—á–Ω—É—é:
sudo chown -R $(id -u):$(id -g) cypress-image-diff-screenshots/ view/
```

### –û–±—Ä–∞–∑ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
```bash
# –£–¥–∞–ª–∏—Ç–µ –æ–±—Ä–∞–∑ –¥–ª—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è
docker rmi cypress-component-tests:cache

# –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –æ–±—Ä–∞–∑
npm run test:screenshots
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Docker | –õ–æ–∫–∞–ª—å–Ω–æ |
|---------------|--------|----------|
| –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å CI | ‚úÖ 100% | ‚ùå –ú–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è |
| –°–∫–æ—Ä–æ—Å—Ç—å (1–π –∑–∞–ø—É—Å–∫) | ‚ö†Ô∏è 30-60s | ‚úÖ 5-10s |
| –°–∫–æ—Ä–æ—Å—Ç—å (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π) | ‚úÖ 5-10s | ‚úÖ 5-10s |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ | ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ |
| –®—Ä–∏—Ñ—Ç—ã | ‚úÖ –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ | ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ |

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- üéØ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker** –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è CI
- ‚ö° **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/–æ—Ç–ª–∞–¥–∫–∏
- üîÑ –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è package.json –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±—É–¥–µ—Ç –¥–æ–ª—å—à–µ (–ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞)
- üí° –î–µ—Ä–∂–∏—Ç–µ –æ–±—Ä–∞–∑ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤